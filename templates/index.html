<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tarefas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Lista de Tarefas</h1>
        <div class="button-container">
            <a href="{{ url_for('new_task') }}" class="btn">Adicionar Nova Tarefa</a>
            <button onclick="showInfo()" class="btn info-btn">Informa√ß√µes</button>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome da Tarefa</th>
                    <th>Custo (R$)</th>
                    <th>Data Limite</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for tarefa in tarefas %}
                <tr class="{% if tarefa.custo|float >= 1000 %}highlight{% endif %}">
                    <td>{{ tarefa.id }}</td>
                    <td>{{ tarefa.nome }}</td>
                    <td>{{ '{:,.2f}'.format(tarefa.custo).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                    <td>{{ tarefa.data_limite.strftime('%d/%m/%Y') }}</td>
                    <td>
                        <div class="action-container">
                            <div class="primary-actions">
                                <a href="{{ url_for('edit_task', id=tarefa.id) }}" class="action-btn edit-btn">‚úèÔ∏è Editar</a>
                                <button onclick="confirmDelete('{{ tarefa.id }}')" class="action-btn delete-btn">üóëÔ∏è Excluir</button>
                            </div>
                            <div class="move-actions">
                                <form action="{{ url_for('move_task', id=tarefa.id, direction='up') }}" method="post">
                                    <button type="submit" class="action-btn move-btn" {% if loop.first %} disabled {% endif %}>
                                        <i class="fas fa-arrow-up"></i> 
                                    </button>
                                </form>
                                <form action="{{ url_for('move_task', id=tarefa.id, direction='down') }}" method="post">
                                    <button type="submit" class="action-btn move-btn" {% if loop.last %} disabled {% endif %}>
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <script>
                    window.onload = function() {
                        swal("Aten√ß√£o!", "{{ messages[0] }}", "warning");
                    }
                </script>
            {% endif %}
        {% endwith %}
    </div>

    <script>
        // Fun√ß√£o para mostrar o popup com informa√ß√µes
        function showInfo() {
            swal({
                title: "Informa√ß√µes do Sistema",
                text: "Criado por Jos√© Filipe.\n\nSistema de gerenciamento de tarefas com funcionalidades de adi√ß√£o, edi√ß√£o e exclus√£o.\nOs nomes das tarefas n√£o podem se repetir e quando houver um custo acima de R$ 1000.0, a tarefa deve ficar amarela.\nDesenvolvido em Python com Flask e SQLite.",
                icon: "info",
                button: "Fechar"
            });
        }

        function confirmDelete(taskId) {
            swal({
                title: "Tem certeza?",
                text: "Voc√™ realmente deseja excluir esta tarefa?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Sim, excluir!",
                cancelButtonText: "Cancelar",
                closeOnConfirm: false
            }, function(isConfirm){
                if (isConfirm) {
                    // Converte o taskId para inteiro se necess√°rio
                    fetch(`/delete/${parseInt(taskId)}`, { method: 'POST' })
                        .then(response => {
                            if (response.ok) {
                                swal("Exclu√≠do!", "A tarefa foi exclu√≠da com sucesso.", "success");
                                location.reload(); // Recarrega a p√°gina
                            } else {
                                swal("Erro", "N√£o foi poss√≠vel excluir a tarefa.", "error");
                            }
                        })
                        .catch(error => {
                            swal("Erro", "Ocorreu um problema ao excluir a tarefa.", "error");
                        });
                }
            });
        }
    </script>
</body>
</html>